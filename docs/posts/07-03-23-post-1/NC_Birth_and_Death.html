<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-03-07">

<title>Eugene’s Deep Learning Journey - NC_Birth_and_Death</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Eugene’s Deep Learning Journey</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/erabinov"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">NC_Birth_and_Death</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 7, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>Loading the Data and Packages</p>
<p>I’m using Google Maps data here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(urbnmapr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmap)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maps)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapdata)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Set up the base NC map:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>ditch_the_axes <span class="ot">&lt;-</span> <span class="fu">theme</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title =</span> <span class="fu">element_blank</span>()</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>states<span class="ot">&lt;-</span><span class="fu">map_data</span>(<span class="st">"state"</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>nc_df<span class="ot">&lt;-</span><span class="fu">subset</span>(states,region<span class="sc">==</span><span class="st">"north carolina"</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>nc_base <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> nc_df, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group)) <span class="sc">+</span> </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="fl">1.3</span>) <span class="sc">+</span> </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"gray"</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>counties<span class="ot">&lt;-</span><span class="fu">map_data</span>(<span class="st">"county"</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>nc_county<span class="ot">&lt;-</span><span class="fu">subset</span>(counties,region<span class="sc">==</span><span class="st">"north carolina"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We read the data in.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>raw.bd1<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">"data/birth_data.csv"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>raw.bd1<span class="sc">$</span>Year<span class="ot">&lt;-</span><span class="fu">as.integer</span>(raw.bd1<span class="sc">$</span>Year)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>raw.bd2<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">"data/birth_data2.csv"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>br<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">"data/Yr1116Birth.csv"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>dr<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">"data/Yr1116Death.csv"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>county.conversion<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">"data/County_Codes_Table_1.csv"</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>county.conversion<span class="ot">&lt;-</span>county.conversion[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>incomes<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">"data/Income_by_Location.csv"</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>incomes<span class="sc">$</span>Geography<span class="ot">&lt;-</span><span class="fu">str_sub</span>(incomes<span class="sc">$</span>Geography,<span class="dv">1</span>,<span class="sc">-</span><span class="dv">12</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>incomes<span class="ot">&lt;-</span><span class="fu">rename</span>(incomes,<span class="at">subregion=</span><span class="st">`</span><span class="at">Geography</span><span class="st">`</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Resolve YOB vs. YEAR column names.</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>br<span class="ot">&lt;-</span><span class="fu">rename</span>(br, <span class="at">YEAR=</span>YOB)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Resolve MRACER vs. RACE column names.</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>br<span class="ot">&lt;-</span><span class="fu">rename</span>(br, <span class="at">RACE=</span>MRACER)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We massage br so that we can compare the br and dr data, and so that we will be able to make a map later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## The birth and death tables contain different codings for race, so I have to change that smh. I begin by defining a function "collapse" which translates the birth data race coding to dezath data race  coding. </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>collapse<span class="ot">&lt;-</span><span class="cf">function</span>(x){</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(x<span class="sc">==</span><span class="dv">1</span><span class="sc">|</span>x<span class="sc">==</span><span class="dv">2</span><span class="sc">|</span>x<span class="sc">==</span><span class="dv">3</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(x)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">4</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>br<span class="sc">$</span>RACE<span class="ot">&lt;-</span><span class="fu">sapply</span>(br<span class="sc">$</span>RACE,collapse)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>county.conversion<span class="sc">$</span>CORES<span class="ot">&lt;-</span><span class="fu">as.double</span>(county.conversion<span class="sc">$</span>CORES)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>br<span class="ot">&lt;-</span><span class="fu">left_join</span>(br,county.conversion[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>br<span class="sc">$</span>COUNTY<span class="ot">&lt;-</span><span class="fu">tolower</span>(br<span class="sc">$</span>COUNTY)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>br<span class="ot">&lt;-</span><span class="fu">rename</span>(br, <span class="at">subregion=</span>COUNTY)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>simple_incomes<span class="ot">&lt;-</span>incomes[incomes<span class="sc">$</span><span class="st">`</span><span class="at">ID Race</span><span class="st">`</span><span class="sc">==</span><span class="dv">0</span><span class="sc">&amp;</span>incomes<span class="sc">$</span><span class="st">`</span><span class="at">ID Year</span><span class="st">`</span><span class="sc">==</span><span class="dv">2016</span>,<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">7</span>)]</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>simple_incomes<span class="sc">$</span>subregion<span class="ot">&lt;-</span><span class="fu">tolower</span>(simple_incomes<span class="sc">$</span>subregion)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>br<span class="ot">&lt;-</span><span class="fu">left_join</span>(br, simple_incomes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In order to minimze some of the variance associated with the small county data, we form 17 clusters of counties, and we will take in-cluster means of all the data in br.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>countycounts<span class="ot">&lt;-</span><span class="fu">count</span>(br,CORES)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>countyracecounts<span class="ot">&lt;-</span><span class="fu">count</span>(br,CORES,RACE)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>race1births<span class="ot">&lt;-</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">100</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  race1births[i]<span class="ot">&lt;-</span> <span class="fu">sum</span>(countyracecounts[countyracecounts<span class="sc">$</span>CORES<span class="sc">==</span>i<span class="sc">&amp;</span>countyracecounts<span class="sc">$</span>RACE<span class="sc">==</span><span class="dv">1</span>,]<span class="sc">$</span>n)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>race2births<span class="ot">&lt;-</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">100</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  race1births[i]<span class="ot">&lt;-</span> <span class="fu">sum</span>(countyracecounts[countyracecounts<span class="sc">$</span>CORES<span class="sc">==</span>i<span class="sc">&amp;</span>countyracecounts<span class="sc">$</span>RACE<span class="sc">==</span><span class="dv">2</span>,]<span class="sc">$</span>n)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>race3births<span class="ot">&lt;-</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">100</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  race1births[i]<span class="ot">&lt;-</span> <span class="fu">sum</span>(countyracecounts[countyracecounts<span class="sc">$</span>CORES<span class="sc">==</span>i<span class="sc">&amp;</span>countyracecounts<span class="sc">$</span>RACE<span class="sc">==</span><span class="dv">3</span>,]<span class="sc">$</span>n)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>race4births<span class="ot">&lt;-</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">100</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  race1births[i]<span class="ot">&lt;-</span> <span class="fu">sum</span>(countyracecounts[countyracecounts<span class="sc">$</span>CORES<span class="sc">==</span>i<span class="sc">&amp;</span>countyracecounts<span class="sc">$</span>RACE<span class="sc">==</span><span class="dv">4</span>,]<span class="sc">$</span>n)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>countycounts<span class="ot">&lt;-</span><span class="fu">bind_cols</span>(countycounts,race1births,race2births,race3births,race4births)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>countycounts<span class="ot">&lt;-</span><span class="fu">rename</span>(countycounts,<span class="at">NUMBIRTH=</span>n,<span class="at">NUM1=</span>...<span class="dv">3</span>,<span class="at">NUM2=</span>...<span class="dv">4</span>,<span class="at">NUM3=</span>...<span class="dv">5</span>,<span class="at">NUM4=</span>...<span class="dv">6</span>)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="do">##We try K-means clustering with about 20 clusters. We try to identify clusters with  We want population to have the largest effect, so we don't normalize the data. The result is probably that race plays a very small role in the size of the clusters.</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>km.out<span class="ot">&lt;-</span><span class="fu">kmeans</span>(countycounts[,<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>],<span class="dv">17</span>,<span class="at">nstart=</span><span class="dv">50</span>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>km.out<span class="sc">$</span>cluster</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1]  4  9 10 12 12 11  8 11  9 14 16  2 16 15 10 17 12  4 17 12 11 10 14 17  3
 [26]  6 12  9  4  9  2  1 17  1 15 16 10 10 17 12  6 17  4 17 14 12 14  7  4  9
 [51] 16 10  2 15 15  8  9 12 12 13 11  9 14 14 16 11  1  5 10  8 17 11  9 16 11
 [76]  3 17  4 14  3 15  2  8 15  9 15 12 12  7 16 17 13 11 11  9  4 15 14  9 11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>countycounts<span class="ot">&lt;-</span><span class="fu">bind_cols</span>(countycounts,<span class="at">CLUSTER=</span>km.out<span class="sc">$</span>cluster)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>COREStoCLUSTER<span class="ot">&lt;-</span><span class="cf">function</span>(x){</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="dv">0</span><span class="sc">&lt;=</span>x<span class="sc">&amp;</span>x<span class="sc">&lt;=</span><span class="dv">100</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(km.out<span class="sc">$</span>cluster[x])</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>clustervals<span class="ot">&lt;-</span><span class="fu">sapply</span>(br<span class="sc">$</span>CORES,COREStoCLUSTER)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>br<span class="ot">&lt;-</span><span class="fu">bind_cols</span>(br,<span class="at">CLUSTER=</span>clustervals)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>drclustervals<span class="ot">&lt;-</span><span class="fu">sapply</span>(dr<span class="sc">$</span>CORES,COREStoCLUSTER)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>dr<span class="ot">&lt;-</span><span class="fu">bind_cols</span>(dr,drclustervals)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>dr<span class="ot">&lt;-</span><span class="fu">rename</span>(dr,<span class="at">CLUSTER=</span>...<span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>brdrcounts<span class="ot">&lt;-</span><span class="fu">count</span>(br,YEAR,CLUSTER,RACE)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>brdrcounts<span class="ot">&lt;-</span><span class="fu">rename</span>(brdrcounts,<span class="at">NUMBIRTH=</span>n)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#I noticed, for example, that the original brdrcounts had no entry for (YEAR,CORES,RACE)=(2011,3,3). Based on a superficial check of a few of the missing values, this seems plausible, but I still want to set NUMBIRTH=0 for the missing combinations. Mostly RACE=3 rows are missing, which seems plausible since the Native American population of NC is around 1-2%. </span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>brdrcounts<span class="ot">&lt;-</span><span class="fu">complete</span>(brdrcounts,YEAR,CLUSTER,RACE)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>brdrcounts<span class="ot">&lt;-</span><span class="fu">replace_na</span>(brdrcounts,<span class="fu">list</span>(<span class="at">NUMBIRTH=</span><span class="dv">0</span>))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>drcounts<span class="ot">&lt;-</span><span class="fu">count</span>(dr,YEAR,CLUSTER,RACE)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Same sort of completion for death counts. There are even more missing combos, since the death numbers overall in a low-population county can be quite small.</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>drcounts<span class="ot">&lt;-</span><span class="fu">complete</span>(drcounts,YEAR,CLUSTER,RACE)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>drcounts<span class="ot">&lt;-</span><span class="fu">replace_na</span>(drcounts,<span class="fu">list</span>(<span class="at">n=</span><span class="dv">0</span>))</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>brdrcounts<span class="ot">&lt;-</span><span class="fu">left_join</span>(brdrcounts,drcounts)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>brdrcounts<span class="ot">&lt;-</span><span class="fu">rename</span>(brdrcounts,<span class="at">NUMDEATH=</span>n)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="do">##I add the group means for each statistic in br to the birth and death counts.</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>brdrcounts<span class="ot">&lt;-</span><span class="fu">bind_cols</span>(brdrcounts,<span class="at">CIGPN=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">nrow</span>(brdrcounts)),<span class="at">CIGFN=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">nrow</span>(brdrcounts)),<span class="at">CIGSN=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">nrow</span>(brdrcounts)),<span class="at">CIGLN=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">nrow</span>(brdrcounts)),<span class="at">BWTG=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">nrow</span>(brdrcounts)),<span class="at">GEST=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">nrow</span>(brdrcounts)),<span class="at">PLUR=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">nrow</span>(brdrcounts)), <span class="at">MAGE=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">nrow</span>(brdrcounts)),<span class="at">PARITY=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">nrow</span>(brdrcounts)),<span class="at">INCOME=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">nrow</span>(brdrcounts)))</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2011</span><span class="sc">:</span><span class="dv">2016</span>) {</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>){</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>){</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>     subset<span class="ot">&lt;-</span>br[br<span class="sc">$</span>YEAR<span class="sc">==</span>i<span class="sc">&amp;</span>br<span class="sc">$</span>CLUSTER<span class="sc">==</span>j<span class="sc">&amp;</span>br<span class="sc">$</span>RACE<span class="sc">==</span>k,]</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>     cigpn<span class="ot">&lt;-</span><span class="fu">mean</span>(subset<span class="sc">$</span>CIGPN)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>     cigfn<span class="ot">&lt;-</span><span class="fu">mean</span>(subset<span class="sc">$</span>CIGFN)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>     cigsn<span class="ot">&lt;-</span><span class="fu">mean</span>(subset<span class="sc">$</span>CIGSN)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>     cigln<span class="ot">&lt;-</span><span class="fu">mean</span>(subset<span class="sc">$</span>CIGLN)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>     bwtg<span class="ot">&lt;-</span><span class="fu">mean</span>(subset<span class="sc">$</span>BWTG)</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>     gest<span class="ot">&lt;-</span><span class="fu">mean</span>(subset<span class="sc">$</span>GEST)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>     plur<span class="ot">&lt;-</span><span class="fu">mean</span>(subset<span class="sc">$</span>PLUR)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>     mage<span class="ot">&lt;-</span><span class="fu">mean</span>(subset<span class="sc">$</span>MAGE)</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>     parity<span class="ot">&lt;-</span><span class="fu">mean</span>(subset<span class="sc">$</span>PARITY)</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>     incomes<span class="ot">&lt;-</span><span class="fu">mean</span>(subset<span class="sc">$</span><span class="st">`</span><span class="at">Household Income by Race</span><span class="st">`</span>)</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>     n<span class="ot">&lt;-</span><span class="fu">which</span>(brdrcounts<span class="sc">$</span>YEAR<span class="sc">==</span>i<span class="sc">&amp;</span>brdrcounts<span class="sc">$</span>CLUSTER<span class="sc">==</span>j<span class="sc">&amp;</span>brdrcounts<span class="sc">$</span>RACE<span class="sc">==</span>k)[[<span class="dv">1</span>]]</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>     brdrcounts[n,<span class="dv">6</span>]<span class="ot">&lt;-</span>cigpn</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>     brdrcounts[n,<span class="dv">7</span>]<span class="ot">&lt;-</span>cigfn</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>     brdrcounts[n,<span class="dv">8</span>]<span class="ot">&lt;-</span>cigsn</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>     brdrcounts[n,<span class="dv">9</span>]<span class="ot">&lt;-</span>cigln</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>     brdrcounts[n,<span class="dv">10</span>]<span class="ot">&lt;-</span>bwtg</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>     brdrcounts[n,<span class="dv">11</span>]<span class="ot">&lt;-</span>gest</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>     brdrcounts[n,<span class="dv">12</span>]<span class="ot">&lt;-</span>plur</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>     brdrcounts[n,<span class="dv">13</span>]<span class="ot">&lt;-</span>mage</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>     brdrcounts[n,<span class="dv">14</span>]<span class="ot">&lt;-</span>parity</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>     brdrcounts[n,<span class="dv">15</span>]<span class="ot">&lt;-</span>incomes</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>     } </span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>brdrcounts<span class="ot">&lt;-</span><span class="fu">replace_na</span>(brdrcounts,<span class="fu">list</span>(<span class="at">CIGPN=</span><span class="dv">0</span>,<span class="at">CIGFN=</span><span class="dv">0</span>,<span class="at">CIGSN=</span><span class="dv">0</span>,<span class="at">CIGLN=</span><span class="dv">0</span>,<span class="at">BWTG=</span><span class="dv">0</span>,<span class="at">GEST=</span><span class="dv">0</span>,<span class="at">PLUR=</span><span class="dv">0</span>,<span class="at">MAGE=</span><span class="dv">0</span>,<span class="at">PARITY=</span><span class="dv">0</span>,<span class="at">INCOME=</span><span class="dv">0</span>))</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>imrates<span class="ot">&lt;-</span>brdrcounts<span class="sc">$</span>NUMDEATH<span class="sc">/</span>brdrcounts<span class="sc">$</span>NUMBIRTH</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>brdrcounts<span class="ot">&lt;-</span><span class="fu">bind_cols</span>(brdrcounts,<span class="at">IMR=</span>imrates)</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="do">## We chose not to replace NaN IMR with 0.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These are the indices in brdrcounts of the CLUSTER/RACE/YEAR combos which have no births:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(brdrcounts<span class="sc">$</span>NUMBIRTH<span class="sc">==</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  27  95 163 231 299 367</code></pre>
</div>
</div>
<p>I’ll take that, as better than having many.</p>
<p>Now, we proceed to try different models on the test data. I think a bit of a warning is in order about concluding too much about variable importance, since we expect there to be significant collinearity between some of the predictors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#brdrcounts$YEAR&lt;-as.factor(brdrcounts$YEAR)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>brdrcounts<span class="sc">$</span>RACE<span class="ot">&lt;-</span><span class="fu">as.factor</span>(brdrcounts<span class="sc">$</span>RACE)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>brdrcounts<span class="sc">$</span>CLUSTER<span class="ot">&lt;-</span><span class="fu">as.factor</span>(brdrcounts<span class="sc">$</span>CLUSTER)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>train.data<span class="ot">&lt;-</span>brdrcounts[brdrcounts<span class="sc">$</span>YEAR<span class="sc">!=</span><span class="dv">2016</span>,]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>test.data<span class="ot">&lt;-</span>brdrcounts[brdrcounts<span class="sc">$</span>YEAR<span class="sc">==</span><span class="dv">2016</span>,]</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>foldsnums<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="fu">nrow</span>(train.data),<span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>fits<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">length=</span><span class="dv">10</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  foldslogical<span class="ot">&lt;-</span>foldsnums<span class="sc">==</span>i</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  fits[[i]]<span class="ot">&lt;-</span> <span class="fu">glm</span>(IMR<span class="sc">~</span>.<span class="sc">-</span>NUMBIRTH<span class="sc">-</span>NUMDEATH,<span class="at">data=</span>train.data,<span class="at">subset=</span>foldslogical,<span class="at">na.action =</span> na.exclude)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaps)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>regfit<span class="ot">&lt;-</span><span class="fu">regsubsets</span>(IMR<span class="sc">~</span>.<span class="sc">-</span>NUMBIRTH<span class="sc">-</span>NUMDEATH,<span class="at">data=</span>train.data,<span class="at">nvmax=</span><span class="dv">35</span>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>val.errors<span class="ot">&lt;-</span><span class="fu">rep</span>(<span class="cn">NA</span>,<span class="dv">30</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>test.mat<span class="ot">&lt;-</span><span class="fu">model.matrix</span>(IMR<span class="sc">~</span>.<span class="sc">-</span>NUMBIRTH<span class="sc">-</span>NUMDEATH,<span class="at">data=</span>test.data)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>) {</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  coefi<span class="ot">&lt;-</span><span class="fu">coef</span>(regfit,<span class="at">id=</span>i)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  pred<span class="ot">&lt;-</span>test.mat[,<span class="fu">names</span>(coefi)]<span class="sc">%*%</span> coefi</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  val.errors[i]<span class="ot">&lt;-</span><span class="fu">mean</span>((<span class="fu">na.omit</span>(test.data<span class="sc">$</span>IMR)<span class="sc">-</span>pred)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="do">##logreg.bycty&lt;-glm(SURVIVED~CORES+YEAR+RACE,data=br,subset=train,family="binomial")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The above is a validation-set approach to variable selection. I find that the best model predicts infant-mortality rates taking into account only whether or not the group is African American:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which.min</span>(val.errors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(regfit,<span class="fu">which.min</span>(val.errors))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)       RACE2 
0.005308092 0.009012201 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>subset.error<span class="ot">&lt;-</span>val.errors[<span class="fu">which.min</span>(val.errors)]</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>subset.error</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0002065257</code></pre>
</div>
</div>
<p>Let’s try lasso regression.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="fu">model.matrix</span>(IMR<span class="sc">~</span>.<span class="sc">-</span>NUMBIRTH<span class="sc">-</span>NUMDEATH,train.data)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>y<span class="ot">&lt;-</span><span class="fu">na.omit</span>(train.data<span class="sc">$</span>IMR)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>cv.lasso<span class="ot">&lt;-</span><span class="fu">cv.glmnet</span>(x,y,<span class="at">alpha=</span><span class="dv">1</span>,<span class="at">family=</span><span class="st">"gaussian"</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cv.lasso)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="NC_Birth_and_Death_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(cv.lasso,cv.lasso<span class="sc">$</span>lambda.min)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>31 x 1 sparse Matrix of class "dgCMatrix"
                       s1
(Intercept)  1.732326e-01
YEAR         .           
CLUSTER2     .           
CLUSTER3     .           
CLUSTER4     .           
CLUSTER5     .           
CLUSTER6     .           
CLUSTER7     8.439871e-04
CLUSTER8     .           
CLUSTER9     .           
CLUSTER10    .           
CLUSTER11   -7.764165e-04
CLUSTER12    1.146498e-03
CLUSTER13    .           
CLUSTER14    .           
CLUSTER15    .           
CLUSTER16    .           
CLUSTER17    .           
RACE2        4.158737e-03
RACE3        .           
RACE4       -2.297542e-03
CIGPN        .           
CIGFN        .           
CIGSN        .           
CIGLN        .           
BWTG        -4.663241e-06
GEST        -3.926446e-03
PLUR         .           
MAGE         .           
PARITY       .           
INCOME       .           </code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(cv.lasso,cv.lasso<span class="sc">$</span>lambda<span class="fl">.1</span>se)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>31 x 1 sparse Matrix of class "dgCMatrix"
                       s1
(Intercept)  6.808897e-02
YEAR         .           
CLUSTER2     .           
CLUSTER3     .           
CLUSTER4     .           
CLUSTER5     .           
CLUSTER6     .           
CLUSTER7     .           
CLUSTER8     .           
CLUSTER9     .           
CLUSTER10    .           
CLUSTER11    .           
CLUSTER12    .           
CLUSTER13    .           
CLUSTER14    .           
CLUSTER15    .           
CLUSTER16    .           
CLUSTER17    .           
RACE2        3.111985e-03
RACE3        .           
RACE4        .           
CIGPN        .           
CIGFN        .           
CIGSN        .           
CIGLN        .           
BWTG        -7.565233e-07
GEST        -1.529002e-03
PLUR         .           
MAGE         .           
PARITY       .           
INCOME       .           </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>simple.lasso.model <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(x, y, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">family =</span> <span class="st">"gaussian"</span>, <span class="at">lambda =</span> cv.lasso<span class="sc">$</span>lambda<span class="fl">.1</span>se)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>best.lasso.model <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(x,y,<span class="at">alpha=</span><span class="dv">1</span>,<span class="at">family=</span><span class="st">"gaussian"</span>,<span class="at">lambda=</span>cv.lasso<span class="sc">$</span>lambda.min)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>test.x<span class="ot">&lt;-</span><span class="fu">model.matrix</span>(IMR<span class="sc">~</span>.<span class="sc">-</span>NUMBIRTH<span class="sc">-</span>NUMDEATH,test.data)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>simple.preds<span class="ot">&lt;-</span><span class="fu">predict</span>(simple.lasso.model,test.x)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>best.preds<span class="ot">&lt;-</span><span class="fu">predict</span>(best.lasso.model,test.x)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>simple.lasso.error<span class="ot">&lt;-</span><span class="fu">mean</span>((simple.preds<span class="sc">-</span><span class="fu">na.omit</span>(test.data<span class="sc">$</span>IMR))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>simple.lasso.error</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0002038072</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>best.lasso.error<span class="ot">&lt;-</span><span class="fu">mean</span>((best.preds<span class="sc">-</span><span class="fu">na.omit</span>(test.data<span class="sc">$</span>IMR))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>best.lasso.error</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0002161291</code></pre>
</div>
</div>
<p>The simple model, which uses only RACE2 (African-American), birth weight in grams, and gestation period, is better than the more complex one on the test data. Also, it is better than the best subset selected model.</p>
<p>An unpruned tree model does worse than all three:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tree)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>tree.model<span class="ot">&lt;-</span><span class="fu">tree</span>(IMR<span class="sc">~</span>.<span class="sc">-</span>NUMBIRTH<span class="sc">-</span>NUMDEATH,train.data)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(tree.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Regression tree:
tree(formula = IMR ~ . - NUMBIRTH - NUMDEATH, data = train.data)
Variables actually used in tree construction:
[1] "BWTG"    "GEST"    "CLUSTER" "PLUR"    "PARITY"  "CIGFN"   "RACE"   
[8] "MAGE"   
Number of terminal nodes:  14 
Residual mean deviance:  3.229e-05 = 0.01036 / 321 
Distribution of residuals:
      Min.    1st Qu.     Median       Mean    3rd Qu.       Max. 
-0.0242200 -0.0018800 -0.0005768  0.0000000  0.0016300  0.0265900 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tree.model)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(tree.model,<span class="at">pretty=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="NC_Birth_and_Death_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>tree.preds<span class="ot">&lt;-</span><span class="fu">predict</span>(tree.model,<span class="fu">na.omit</span>(test.data))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>tree.error<span class="ot">&lt;-</span><span class="fu">mean</span>((<span class="fu">na.omit</span>(tree.preds)<span class="sc">-</span><span class="fu">na.omit</span>(test.data<span class="sc">$</span>IMR))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>tree.error</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0002433887</code></pre>
</div>
</div>
<p>Let’s do some tree pruning. The following shows that the minimum deviance is obtained via a tree with 5 nodes. The pruning improves the test MSE a bit, but it still doesn’t beat the lasso.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>tree.cv<span class="ot">&lt;-</span><span class="fu">cv.tree</span>(tree.model)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tree.cv<span class="sc">$</span>size,tree.cv<span class="sc">$</span>dev,<span class="at">type=</span><span class="st">"b"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="NC_Birth_and_Death_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>prune.tree.model<span class="ot">&lt;-</span><span class="fu">prune.tree</span>(tree.model,<span class="at">best=</span><span class="dv">5</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prune.tree.model)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(prune.tree.model,<span class="at">pretty=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="NC_Birth_and_Death_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>prune.tree.preds<span class="ot">&lt;-</span><span class="fu">predict</span>(prune.tree.model,<span class="fu">na.omit</span>(test.data))</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>prune.error<span class="ot">&lt;-</span><span class="fu">mean</span>((<span class="fu">na.omit</span>(prune.tree.preds)<span class="sc">-</span><span class="fu">na.omit</span>(test.data<span class="sc">$</span>IMR))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>prune.error</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0002200646</code></pre>
</div>
</div>
<p>Let’s try random forests. These don’t provide a dramatic improvement over the single tree. Continue to confirm that RACE, GEST, and BWTG are biggest predictors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>rf.model<span class="ot">&lt;-</span><span class="fu">randomForest</span>(IMR<span class="sc">~</span>.<span class="sc">-</span>NUMBIRTH<span class="sc">-</span>NUMDEATH,<span class="fu">na.omit</span>(train.data), <span class="at">importance=</span><span class="cn">TRUE</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>rf.model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
 randomForest(formula = IMR ~ . - NUMBIRTH - NUMDEATH, data = na.omit(train.data),      importance = TRUE) 
               Type of random forest: regression
                     Number of trees: 500
No. of variables tried at each split: 4

          Mean of squared residuals: 5.982042e-05
                    % Var explained: 18.83</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>rf.preds<span class="ot">&lt;-</span><span class="fu">predict</span>(rf.model,<span class="at">newdata=</span><span class="fu">na.omit</span>(test.data))</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>rf.error<span class="ot">&lt;-</span><span class="fu">mean</span>((rf.preds<span class="sc">-</span><span class="fu">na.omit</span>(test.data<span class="sc">$</span>IMR))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>rf.error</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0002202987</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">varImpPlot</span>(rf.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="NC_Birth_and_Death_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Have to try boosting:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gbm)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">15</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>boost.model<span class="ot">&lt;-</span><span class="fu">gbm</span>(IMR<span class="sc">~</span>.<span class="sc">-</span>NUMBIRTH<span class="sc">-</span>NUMDEATH,<span class="at">data=</span><span class="fu">na.omit</span>(train.data),<span class="at">distribution=</span><span class="st">"gaussian"</span>,<span class="at">n.trees=</span><span class="dv">5000</span>,<span class="at">interaction.depth=</span><span class="dv">4</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(boost.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="NC_Birth_and_Death_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>            var   rel.inf
CLUSTER CLUSTER 31.569196
GEST       GEST 12.781752
BWTG       BWTG 10.765729
PLUR       PLUR  9.510822
RACE       RACE  7.189561
MAGE       MAGE  6.451966
PARITY   PARITY  6.013129
CIGPN     CIGPN  4.016546
CIGFN     CIGFN  3.494723
INCOME   INCOME  3.101411
CIGSN     CIGSN  1.897428
CIGLN     CIGLN  1.866473
YEAR       YEAR  1.341264</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>boost.preds<span class="ot">&lt;-</span><span class="fu">predict</span>(boost.model,<span class="at">newdata=</span><span class="fu">na.omit</span>(test.data))</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>boost.error<span class="ot">&lt;-</span><span class="fu">mean</span>((boost.preds<span class="sc">-</span><span class="fu">na.omit</span>(test.data<span class="sc">$</span>IMR))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>boost.error</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0002398635</code></pre>
</div>
</div>
<p>Now, we summarize our results. As a whole, the regularized linear methods worked the best. Of the trees, the best method was the pruned tree.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>mean.error<span class="ot">&lt;-</span><span class="fu">mean</span>(<span class="fu">na.omit</span>(test.data<span class="sc">$</span>IMR)<span class="sc">-</span><span class="fu">mean</span>(<span class="fu">na.omit</span>(train.data<span class="sc">$</span>IMR)))<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>test.error.data<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Method=</span><span class="fu">c</span>(<span class="st">"No Dependence on Predictors"</span>,<span class="st">"Best Subset Linear Model"</span>,<span class="st">"Simple Lasso"</span>,<span class="st">"Lowest MSE Lasso"</span>,<span class="st">"Tree"</span>,<span class="st">"Pruned Tree"</span>,<span class="st">"Random Forests"</span>,<span class="st">"Boosting"</span>),<span class="st">`</span><span class="at">Test Error</span><span class="st">`</span><span class="ot">=</span><span class="fu">c</span>(mean.error,subset.error,simple.lasso.error,best.lasso.error,tree.error,prune.error,rf.error,boost.error))</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>test.error.data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       Method   Test.Error
1 No Dependence on Predictors 1.541823e-06
2    Best Subset Linear Model 2.065257e-04
3                Simple Lasso 2.038072e-04
4            Lowest MSE Lasso 2.161291e-04
5                        Tree 2.433887e-04
6                 Pruned Tree 2.200646e-04
7              Random Forests 2.202987e-04
8                    Boosting 2.398635e-04</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>br.dr.race.year<span class="ot">&lt;-</span><span class="fu">count</span>(br,RACE,YEAR)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>br.dr.race.year<span class="ot">&lt;-</span><span class="fu">rename</span>(br.dr.race.year,<span class="at">numbirth=</span>n)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>br.dr.race.year<span class="ot">&lt;-</span><span class="fu">left_join</span>(br.dr.race.year, <span class="fu">count</span>(dr,RACE,YEAR))</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>br.dr.race.year<span class="ot">&lt;-</span><span class="fu">rename</span>(br.dr.race.year,<span class="at">numdeath=</span>n)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>data.plot<span class="ot">&lt;-</span><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>YEAR, <span class="at">y =</span> numdeath<span class="sc">/</span>numbirth,<span class="at">colour =</span> <span class="st">"White"</span>), <span class="at">data=</span>br.dr.race.year[br.dr.race.year<span class="sc">$</span>RACE<span class="sc">==</span><span class="dv">1</span>,], )<span class="sc">+</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>YEAR, <span class="at">y =</span> numdeath<span class="sc">/</span>numbirth,<span class="at">colour =</span> <span class="st">"Black"</span>), <span class="at">data=</span>br.dr.race.year[br.dr.race.year<span class="sc">$</span>RACE<span class="sc">==</span><span class="dv">2</span>,], )<span class="sc">+</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>YEAR, <span class="at">y =</span> numdeath<span class="sc">/</span>numbirth,<span class="at">colour =</span> <span class="st">"Indian"</span>), <span class="at">data=</span>br.dr.race.year[br.dr.race.year<span class="sc">$</span>RACE<span class="sc">==</span><span class="dv">3</span>,], )<span class="sc">+</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>YEAR, <span class="at">y =</span> numdeath<span class="sc">/</span>numbirth,<span class="at">colour =</span> <span class="st">"Other"</span>), <span class="at">data=</span>br.dr.race.year[br.dr.race.year<span class="sc">$</span>RACE<span class="sc">==</span><span class="dv">4</span>,], )<span class="sc">+</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Race"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"White"</span> <span class="ot">=</span> <span class="st">"darkred"</span>, <span class="st">"Black"</span> <span class="ot">=</span> <span class="st">"darkblue"</span>,<span class="st">"Indian"</span><span class="ot">=</span><span class="st">"darkgreen"</span>,<span class="st">"Other"</span><span class="ot">=</span><span class="st">"black"</span>))</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>data.plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="NC_Birth_and_Death_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Going to try to make a map of North Carolina, and to see the county FIPs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>br.dr.county<span class="ot">&lt;-</span><span class="fu">count</span>(br,subregion)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>br.dr.county<span class="ot">&lt;-</span><span class="fu">rename</span>(br.dr.county,<span class="at">numbirth=</span>n)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>dr.county<span class="ot">&lt;-</span><span class="fu">count</span>(dr,CORES)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>dr.county<span class="ot">&lt;-</span><span class="fu">left_join</span>(dr.county,county.conversion[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>dr.county<span class="ot">&lt;-</span><span class="fu">rename</span>(dr.county,<span class="at">subregion=</span>COUNTY)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>dr.county<span class="ot">&lt;-</span><span class="fu">rename</span>(dr.county,<span class="at">numdeath=</span>n)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>dr.county<span class="sc">$</span>subregion<span class="ot">&lt;-</span><span class="fu">tolower</span>(dr.county<span class="sc">$</span>subregion)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>br.dr.county<span class="ot">&lt;-</span><span class="fu">left_join</span>(br.dr.county,dr.county)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>imr<span class="ot">&lt;-</span>br.dr.county<span class="sc">$</span>numdeath<span class="sc">/</span>br.dr.county<span class="sc">$</span>numbirth</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>br.dr.county<span class="ot">&lt;-</span><span class="fu">bind_cols</span>(br.dr.county,<span class="at">IMR=</span>imr)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>nccodr<span class="ot">&lt;-</span><span class="fu">inner_join</span>(nc_county,br.dr.county,<span class="at">by=</span><span class="st">"subregion"</span>)</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>drmap <span class="ot">&lt;-</span> nc_base <span class="sc">+</span> </span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_polygon</span>(<span class="at">data =</span> nccodr, <span class="fu">aes</span>(<span class="at">fill =</span> IMR), <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_polygon</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>      ditch_the_axes<span class="sc">+</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_gradient</span>(</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">low =</span> <span class="st">"#00FFFF"</span>,</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">high =</span> <span class="st">"#000000"</span>,</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">space =</span> <span class="st">"Lab"</span>,</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">na.value =</span> <span class="st">"grey50"</span>,</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">guide =</span> <span class="st">"colourbar"</span>,</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">aesthetics =</span> <span class="st">"fill"</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>drmap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="NC_Birth_and_Death_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>